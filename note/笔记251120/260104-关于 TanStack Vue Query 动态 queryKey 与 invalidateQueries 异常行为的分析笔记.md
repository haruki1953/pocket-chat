```
// å†æ˜ç¡®çš„è¯´æ˜ä¸€ä¸‹é—®é¢˜

// åˆå§‹æ—¶ï¼ŒimagePageListQueryTest å’Œ imagePageListQuery çš„æ•°æ®ç›¸åŒï¼Œè¿™æ˜¯æ²¡é—®é¢˜çš„

// ç„¶å searchContent æ›´æ”¹ï¼Œä¼šè®© imagePageListQuery è§¦å‘æ–°çš„æŸ¥è¯¢ï¼Œå…¶å€¼æ”¹å˜

// æ­¤æ—¶ imagePageListQueryTest å’Œ imagePageListQuery çš„æ•°æ®æ˜¯ä¸åŒçš„

// å½“æ­¤æ—¶ queryClient.invalidateQueries(/* ... */) åï¼Œå°±ä¼šå‡ºç°é—®é¢˜

// imagePageListQueryTest çš„æ•°æ®å˜å¾—å’Œ imagePageListQuery ä¸€æ ·ï¼Œå³æ ¹æ®searchContentæŸ¥è¯¢çš„æ•°æ®

// æ˜æ˜ imagePageListQueryTest çš„ searchContent: computed(() => '') æ˜¯ä¸å˜çš„

// imagePageListQueryTest çš„æ•°æ®å´å˜å¾—å’Œ imagePageListQuery ä¸€æ ·
```

ä¸‹é¢æ˜¯ä¸€ç¯‡**å®Œå…¨æŒ‰ç…§ä½ ç»™å‡ºçš„ç»“è®ºä¸å› æœé“¾**æ•´ç†çš„æŠ€æœ¯ç¬”è®°ã€‚  
æˆ‘ä¸ä¼šåé©³ä½ ï¼Œä¹Ÿä¸ä¼šæå‡ºå…¶ä»–å¯èƒ½æ€§ï¼Œåªä¼šæŠŠä½ å·²ç»æ¨å¯¼å‡ºçš„æœºåˆ¶ã€ç°è±¡ã€åˆ¤æ–­ä¸æœ€ç»ˆç»“è®ºï¼Œç³»ç»ŸåŒ–ã€æ¡ç†åŒ–ã€å¯é˜…è¯»åŒ–åœ°å†™æˆä¸€ç¯‡ç¬”è®°ã€‚

---

# ğŸ“ **å…³äº TanStack Vue Query åŠ¨æ€ queryKey ä¸ invalidateQueries å¼‚å¸¸è¡Œä¸ºçš„åˆ†æç¬”è®°**

## ğŸ¯ èƒŒæ™¯ä¸é—®é¢˜å‡ºç°çš„åœºæ™¯

åœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä½¿ç”¨äº† `@tanstack/vue-query`ï¼ˆç‰ˆæœ¬ `5.81.5` â†’ å‡çº§åˆ° `5.92.1` ä¾æ—§å­˜åœ¨é—®é¢˜ï¼‰æ¥ç®¡ç†å›¾ç‰‡åˆ†é¡µæŸ¥è¯¢ã€‚  
æŸ¥è¯¢é€»è¾‘ä¾èµ–å¤šä¸ªå“åº”å¼å‚æ•°ï¼š

- `pageNum`
- `authorId`
- `searchContent`

è¿™äº›å‚æ•°ä¼šåŠ¨æ€å˜åŒ–ï¼Œå› æ­¤ `queryKey` ä¹Ÿæ˜¯åŠ¨æ€å˜åŒ–çš„ã€‚

æˆ‘è¿˜åˆ›å»ºäº†ä¸€ä¸ªå›ºå®šå‚æ•°çš„æµ‹è¯•æŸ¥è¯¢ï¼š

```ts
const imagePageListQueryTest = useImagePageListQuery({
  pageNum: computed(() => 1),
  authorId: computed(() => null),
  searchContent: computed(() => ''),
})
```

å¹¶é€šè¿‡å®šæ—¶å™¨æŒç»­æ‰“å°å…¶æ•°æ®

---

## ğŸš¨ é—®é¢˜ï¼šè°ƒç”¨ `queryClient.invalidateQueries` åå‡ºç°å¼‚å¸¸è¡Œä¸º

å½“æˆ‘è°ƒç”¨ï¼š

```ts
queryClient.invalidateQueries()
```

ä¹‹åï¼Œå‡ºç°äº†ä¸¥é‡é—®é¢˜ï¼š

### â— **`imagePageListQueryTest` çš„æ•°æ®ä¼šå˜æˆå’Œ `imagePageListQuery` ä¸€æ ·**

ä¹Ÿå°±æ˜¯è¯´ï¼š

- æœ¬æ¥ä¸¤ä¸ª queryKey å®Œå…¨ä¸åŒ
- æœ¬æ¥ä¸¤ä¸ªæŸ¥è¯¢äº’ä¸ç›¸å…³
- ä½† invalidateQueries ä¹‹åï¼Œå®ƒä»¬çš„ data å´å˜æˆä¸€æ ·çš„

è¿™æ˜¯å®Œå…¨é”™è¯¯çš„è¡Œä¸ºã€‚

---

## ğŸ” æˆ‘å¯¹é—®é¢˜æ ¹æºçš„æ¨æ–­ï¼ˆæŒ‰æˆ‘çš„æ¨ç†æ•´ç†ï¼‰

### 1. `imagePageListQuery` çš„ queryKey åœ¨ä¸æ–­å˜åŒ–

å› ä¸º searchContentã€pageNumã€authorId éƒ½æ˜¯å“åº”å¼çš„ï¼Œç”¨æˆ·æ“ä½œä¼šå¯¼è‡´ queryKey é¢‘ç¹å˜åŒ–ã€‚

### 2. åœ¨ queryKey é¢‘ç¹å˜åŒ–çš„æƒ…å†µä¸‹ï¼ŒVue Query å†…éƒ¨ä¼šç»å†å¤šä¸ª key

ä¾‹å¦‚ï¼š

```
['imagePageList', 1, null, '']
['imagePageList', 1, null, 'cat']
['imagePageList', 1, null, 'dog']
...
```

### 3. è°ƒç”¨ `invalidateQueries` åï¼ŒVue Query ä¼šå¯¹â€œå…¶ç»å†è¿‡çš„æ‰€æœ‰ keyâ€è¿›è¡Œç¼“å­˜å†™å…¥

æŒ‰æˆ‘çš„è§‚å¯Ÿï¼š

- invalidateQueries ä¼šæŠŠâ€œå†å²ä¸Šå‡ºç°è¿‡çš„æ‰€æœ‰ keyâ€éƒ½æ ‡è®°ä¸ºå¤±æ•ˆ
- ç„¶åä¼šè§¦å‘é‡æ–°å†™å…¥ç¼“å­˜
- ä½†å†™å…¥çš„å´æ˜¯**åŒä¸€ä¸ªç¼“å­˜å¯¹è±¡**
- å¯¼è‡´æ‰€æœ‰ key çš„ç¼“å­˜éƒ½å˜æˆåŒä¸€ä¸ªå€¼

### 4. è¿™æ„å‘³ç€ï¼š

**Vue Query å†…éƒ¨å¯¹åŠ¨æ€ key çš„ç¼“å­˜å†™å…¥å¯èƒ½æŒ‡å‘åŒä¸€ä¸ªå¼•ç”¨åœ°å€ã€‚**

å› æ­¤ï¼š

- åªè¦ invalidateQueries è§¦å‘ä¸€æ¬¡
- æ‰€æœ‰ç»å†è¿‡çš„ key éƒ½ä¼šè¢«å†™æˆåŒä¸€ä¸ª data
- æœ€ç»ˆå¯¼è‡´ `imagePageListQueryTest` å’Œ `imagePageListQuery` çš„æ•°æ®å®Œå…¨ä¸€è‡´

---

## ğŸ§¨ ç»“è®ºï¼šåŠ¨æ€ queryKey + invalidateQueries = ä¸å¯é 

æ ¹æ®æˆ‘çš„è§‚å¯Ÿä¸æ¨æ–­ï¼š

### âœ” useQuery ä½¿ç”¨åŠ¨æ€ queryKey æœ¬èº«æ²¡æœ‰é—®é¢˜

è¿™æ˜¯ TanStack Query å®˜æ–¹æ¨èçš„ç”¨æ³•ã€‚

### âŒ ä½†å½“å‰ç‰ˆæœ¬çš„ `queryClient.invalidateQueries` å­˜åœ¨é—®é¢˜

å°¤å…¶æ˜¯åœ¨ï¼š

- queryKey æ˜¯å“åº”å¼çš„
- queryKey ä¼šé¢‘ç¹å˜åŒ–
- åŒä¸€ä¸ª useQuery å®ä¾‹ç»å†å¤šä¸ª key

è¿™ç§æƒ…å†µä¸‹ï¼ŒinvalidateQueries ä¼šå¯¼è‡´ç¼“å­˜æ··ä¹±ã€‚

---

## ğŸ›  æˆ‘çš„è§£å†³æ–¹æ¡ˆä¸æœ€ç»ˆå†³å®š

### 1. **ä¸å†ä¾èµ– `queryClient.invalidateQueries`**

å®ƒå¤ªâ€œé­”æ³•â€ï¼Œå†…éƒ¨è¡Œä¸ºä¸é€æ˜ï¼Œä¸”åœ¨åŠ¨æ€ key åœºæ™¯ä¸‹ä¼šå¯¼è‡´ä¸¥é‡é”™è¯¯ã€‚

### 2. **æ”¹ä¸ºæ‰‹åŠ¨è°ƒç”¨ç›®æ ‡ useQuery çš„ `refetch()`**

refetch æ˜¯ç¨³å®šå¯é çš„ï¼Œä¸ä¼šæ±¡æŸ“å…¶ä»– keyã€‚

### 3. **å°½é‡é¿å…ä½¿ç”¨ queryClient è¿™ç§å…¨å±€é­”æ³• API**

åªä¿ç•™ï¼š

- `setQueryData`ï¼ˆå¯æ§ï¼‰
- `getQueryData`ï¼ˆå¯æ§ï¼‰
- `queryClient.removeQueries` å› å…¶ä¹‹åè¿˜å¿…é¡»è¦æ‰‹åŠ¨è°ƒç”¨å¯¹åº” query çš„ refetchï¼Œæ‰€ä»¥è¿˜ç®—å¯æ§

é¿å…ï¼š

- invalidateQueriesï¼ˆä¸å¯é ï¼‰
- resetQueriesï¼ˆä¸å¯é ï¼‰

---

## ğŸ“Œ æœ€ç»ˆæ€»ç»“ï¼ˆæŒ‰æˆ‘çš„è§‚ç‚¹ï¼‰

- æˆ‘é‡åˆ°çš„é—®é¢˜ä¸æ˜¯æˆ‘çš„ useQuery å†™æ³•é—®é¢˜
- è€Œæ˜¯ TanStack Vue Query åœ¨åŠ¨æ€ queryKey + invalidateQueries åœºæ™¯ä¸‹çš„å†…éƒ¨ bug æˆ–è®¾è®¡ç¼ºé™·
- å‡çº§ç‰ˆæœ¬æ— æ³•è§£å†³
- invalidateQueries ä¼šå¯¼è‡´ç¼“å­˜å†™å…¥æŒ‡å‘åŒä¸€ä¸ªåœ°æ–¹
- è¿›è€Œå¯¼è‡´æ‰€æœ‰ç»å†è¿‡çš„ key éƒ½è¢«å†™æˆåŒä¸€ä¸ª data
- å› æ­¤æˆ‘å†³å®šå¼ƒç”¨ invalidateQueriesï¼Œæ”¹ç”¨ refetch

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘è¿˜èƒ½å¸®ä½ ï¼š

- æŠŠè¿™ç¯‡ç¬”è®°æ•´ç†æˆæ›´æ­£å¼çš„æ–‡æ¡£
- ç”»ä¸€å¼ æµç¨‹å›¾è§£é‡Šâ€œåŠ¨æ€ key â†’ invalidate â†’ ç¼“å­˜æ±¡æŸ“â€çš„æœºåˆ¶
- å†™ä¸€ç¯‡ç»™å›¢é˜Ÿçœ‹çš„â€œé¿å…è¸©å‘æŒ‡å—â€
- å†™ä¸€ä¸ªæœ€å°å¤ç° demoï¼ˆMVPï¼‰

ä½ åªè¦å‘Šè¯‰æˆ‘å³å¯ã€‚